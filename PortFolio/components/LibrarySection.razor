@using PortFolio.components
@using PortFolio.Services
@using PortFolio.Models

<section id="@Id" class="reveal section-opt mt-10 mb-6">
    <div class="manga-panel halftone gpu">
        <div class="mb-8 pl-2">
            <span class="stamp anim-stamp">Bibliothèque</span>
            <h2 class="ink-title text-3xl mt-2">Mes livres</h2>
            <p class="ink-muted mt-2 max-w-2xl">
                Tous mes projets et expérimentations. Cliquez sur un tome pour l'ouvrir.
            </p>
        </div>

        <LibraryShelf Title="Projets"
                      Subtitle="Des applications solides, en mode tome."
                      BadgeText="Shelf 01"
                      Books="@_projects" />

        @if (_demos.Count > 0)
        {
            <div class="mt-8">
                <LibraryShelf Title="Démos"
                              Subtitle="Des idées rapides"
                              BadgeText="Shelf 02"
                              Books="@_demos" />
            </div>
        }
    </div>
</section>

@code {
    [Parameter] public string Id { get; set; } = "library";

    private IReadOnlyList<LibraryShelf.BookItem> _projects = Array.Empty<LibraryShelf.BookItem>();
    private IReadOnlyList<LibraryShelf.BookItem> _demos = Array.Empty<LibraryShelf.BookItem>();

    protected override void OnInitialized()
    {
        var allBooks = BookRepository.GetAll();
        var demoSlugs = new[] { "equi-assiette-hackathon", "elaud-coiffure", "ink-ui" };

        _demos = allBooks
            .Where(b => demoSlugs.Contains(b.Slug))
            .Select(MapToBookItem)
            .ToList();

        _projects = allBooks
            .Where(b => !demoSlugs.Contains(b.Slug))
            .Select(MapToBookItem)
            .ToList();
    }

    private LibraryShelf.BookItem MapToBookItem(BookData b) => new(
        Title: b.Title,
        Href: $"/library/{b.Slug}",
        Meta: b.ShelfMeta,
        Accent: b.AccentColor,
        Stamp: b.StampLabel,
        WidthPx: b.WidthPx,
        HeightPx: b.HeightPx
    );
}
